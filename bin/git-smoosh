#!/bin/bash
set -o errexit

if [[ -z "$1" ]]; then
    THIS_SCRIPT=$'\u001b[1m'"$(basename $0)"$'\u001b[0m'
    echo "Usage: $THIS_SCRIPT topic_branch"
    exit 1
fi

TOPIC_BRANCH=$1

git merge --squash $TOPIC_BRANCH

HEAD_BRANCH=$(git rev-parse --abbrev-ref HEAD)
MSG="
# This will become a commit message for branch $HEAD_BRANCH
# Combine the commit messages below from branch $TOPIC_BRANCH
"
CMD="git log --ancestry-path --max-parents=1 --format=%s%n%n%b HEAD..$TOPIC_BRANCH"
git commit -F <(echo "$MSG"; $CMD) --edit

